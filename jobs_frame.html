<!-- $Id: jobs_frame.html,v 1.1 2004/07/16 22:05:44 jz Exp $ -->
<html>

<head>
    <meta name="vs_targetSchema"    content="http://schemas.microsoft.com/intellisense/ie5"/>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>

    <title>Scheduler</title>

    <style type="text/css">
        h1           { font-size: 24pt; font-weight: bold; margin-bottom: 4ex;  }
        h2           { font-size: 12pt; font-weight: bold; margin-top: 10ex; }
        h3           { font-size: 10pt; font-weight: bold; margin-top: 6ex }
        .zwischentitel { font-weight: bold; margin-top: 6ex }
        body         { font-size: 10pt; }
        th           { font-size: 10pt; }
        td           { font-size: 10pt; }
        p            { font-size: 10pt; margin-top: 2ex; margin-bottom: 0  }
        div          { font-size: 10pt; }
        span         { font-size: 10pt; }
        li           { font-size: 10pt; }
        pre          { font-family: Lucida Console, monospace; font-size: 9pt; margin-left: 5mm; line-height: 1.2em; }
        .indent      { margin-left: 5mm; }
        .mono        { font-family: Lucida Console, monospace; font-size: 9pt }
        .small       { font-family: Sans-Serif; font-size: 8pt }
    </style>
</head>

<body>

<xml id="stylesheet">
    <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
        <xsl:template match="/spooler/answer">
            <b>Scheduler state at <xsl:value-of select="state/@time"/></b>
            <p>&#160;</p>
            <table>
                <col valign="top" align="left"  style="padding-right: 2ex" />
                <col valign="top" align="left"  style="padding-right: 2ex"/>  
                <col valign="top" align="right" style="padding-right: 2ex"/>
                <col valign="top" align="left"  style="padding-right: 2ex"/>
                <col valign="top" align="left"  style="padding-right: 2ex"/>
                <thead>
                    <tr>
                        <th>Job</th>
                        <th>State</th>
                        <th>Steps</th>
                        <th>Order</th>
                    </tr>
                    <tr>
                        <td colspan="99">
                            <hr size="1"/>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <xsl:for-each select="state/jobs/job">
                        <tr>
                            <td colspan="99">
                                <b><xsl:value-of select="@job"/></b>
                                &#160;
                                <xsl:value-of select="@title"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                            </td>
                            <td>
                                <xsl:value-of select="@state"/>
                                <xsl:if test="@state_text!=''">
                                    <xsl:text> &#160; </xsl:text>
                                    <xsl:value-of select="@state_text"/>
                                </xsl:if>
                                <xsl:if test="@waiting_for_process='yes'">
                                    <br/>(waiting for process)
                                </xsl:if>
                            </td>
                            <td align="right">
                                <xsl:value-of select="@all_steps"/>
                                </td>
                            <td>
                                <xsl:choose>
                                    <xsl:when test="@order!='yes'">
                                        (no order job)
                                    </xsl:when>
                                    <xsl:when test="order_queue/@length!=''">
                                        <xsl:value-of select="order_queue/@length"/> orders to process
                                    </xsl:when>
                                </xsl:choose>
                            </td>
                        </tr>

                        <xsl:if test="tasks/task">
                            <tr>
                                <td>
                                </td>
                                <td colspan="99">
                                    <xsl:apply-templates select="tasks"/>
                                </td>
                            </tr>
                        </xsl:if>
                        
                        <tr>
                            <td colspan="99">
                                <hr size="1"/>
                            </td>
                        </tr>
                    </xsl:for-each>
                </tbody>
            </table>
        </xsl:template>

        <xsl:template match="tasks">
            <xsl:for-each select="task">
                <xsl:element name="tr">
                    <xsl:attribute name="style"      >cursor: hand</xsl:attribute>
                    <xsl:attribute name="onmouseover">this.style.backgroundColor="yellow"</xsl:attribute>
                    <xsl:attribute name="onmouseout" >this.style.backgroundColor="window"</xsl:attribute>
                    <xsl:attribute name="onclick">show_task_details( '<xsl:value-of select="../../@job"/>', <xsl:value-of select="@id"/> )</xsl:attribute>
                    
                    <td>
                        &#160; &#160;
                        <span>
                            Task <xsl:value-of select="@id"/>
                        </span>
                        <xsl:if test="@name!=''">
                            &#160; <xsl:value-of select="@name"/>
                        </xsl:if>
                    </td>
                    <td>
                        <xsl:value-of select="@state"/>
                    </td>
                    <td>
                        <xsl:value-of select="@steps"/>
                    </td>
                    <td>
                        <xsl:if test="order">
                            <xsl:value-of select="order/@id"/>
                            <xsl:if test="order/@title != ''">
                                &#160;
                                <xsl:value-of select="order/@title"/>
                            </xsl:if>
                        </xsl:if>
                    </td>
<!--                            
                    <td align="right">
                        <xsl:choose>
                            <xsl:when test="@running_since">
                                started <xsl:value-of select="@start_at"/>
                            </xsl:when>
                            <xsl:when test="@start_at">
                                start at <xsl:value-of select="@start_at"/>
                            </xsl:when>
                            <xsl:when test="@enqueued">
                                enqueued <xsl:value-of select="@enqueued"/>
                            </xsl:when>
                            </xsl:choose>
                    </td>
                    <td>
                        <xsl:value-of select="@cause"/>
                    </td>
                    <td>
                        <xsl:value-of select="@idle_since"/>
                    </td>
                    <td>
                        <xsl:value-of select="@running_since"/>
                    </td>
                    <td>
                        <xsl:value-of select="@enqueued"/>
                    </td>
                    <td>
                        <xsl:value-of select="@in_process_since"/>
                    </td>
                    <td>
                        <xsl:value-of select="@calling"/>
                    </td>
                    <td>
                        <xsl:value-of select="@pid"/>
                    </td>
-->                            
                </xsl:element>
            </xsl:for-each>
        </xsl:template>
        
    </xsl:stylesheet>
</xml>

<script defer="true" type="text/javascript" src="scheduler.js"></script>

<script type="text/javascript" for="window" event="onload"> do_onload(); </script>

<script defer="true" language="javascript"><!--
//-------------------------------------------------------------------------------------------------

var stylesheet;
var response;

//-------------------------------------------------------------------------------------------onload

function do_onload()
{
    stylesheet = document.all.stylesheet.XMLDocument;
    if( stylesheet.parseError.errorCode )  throw new Error( "Fehler im Stylesheet:\n" + stylesheet.parseError.reason );

    
    document.all.stylesheet.outerHTML = "<span id='stylesheet'></span>";
    
    scheduler = new Scheduler();
    //scheduler.execute_and_fill_html(  "<show_state what='all'/>" );

    response = scheduler.execute( "<show_state what='all'/>" );
    document.all.stylesheet.innerHTML = response.transformNode( stylesheet );;
}

//--------------------------------------------------------------------------------show_task_details

function show_task_details( job_name, task_id )
{
    var job_element  = response.selectSingleNode( ".//job[@job='" + job_name + "']" );
    var task_element = response.selectSingleNode( ".//task[@id=" + task_id + "]" );

    window.parent.details_frame.show_task_details( job_element, task_element );
}

//-------------------------------------------------------------------------------------------------
--></script>

</body>

</html>
